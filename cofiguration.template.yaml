# =========================================================
# LUMENTA â€“ main configuration file
# =========================================================

# ---------------------------------------------------------
# HTTP / API server settings
# ---------------------------------------------------------
server:
  # Server bind address (host:port)
  addr: ":8080"

  # HTTP timeout configuration
  timeouts:
    # Request read timeout
    read: 10s

    # Response write timeout
    write: 30s

    # Keep-alive idle timeout
    idle: 60s


# ---------------------------------------------------------
# Database connection settings (MariaDB / MySQL)
# ---------------------------------------------------------
database:
  # Database host name or IP address
  host: "localhost"

  # Database port number
  port: 3306

  # Database name
  name: "lumenta"

  # Database user name
  user: "lumenta"

  # Database password (prefer environment override)
  password: "secret"


# ---------------------------------------------------------
# Filesystem configuration
# ---------------------------------------------------------
filesystem:
  # Read-only originals directory path
  originals: "/mnt/photos/originals"

  # Writable derivatives cache directory path
  derivatives: "/var/lib/lumenta/derivatives"


# ---------------------------------------------------------
# Authentication / authorization
# ---------------------------------------------------------
auth:
  # Authentication mode
  # - forward : reverse-proxy header based authentication
  # - oidc    : OpenID Connect authentication
  mode: "forward"

  # Forward authentication settings
  forward:
    # HTTP header containing the authenticated user name
    user_header: "X-Forwarded-User"

    # HTTP header containing group membership information
    groups_header: "X-Forwarded-Groups"

    # Trusted proxy CIDR ranges
    trusted_proxy_cidr:
      - "127.0.0.1/32"
      - "192.168.0.0/16"

    # Admin role or group name granting admin access (same semantics as OIDC)
    admin_role: "admin"

  # OpenID Connect settings
  oidc:
    # OIDC issuer URL
    issuer: "https://auth.example.com"

    # Registered OIDC client identifier
    client_id: "lumenta"

    # Role or group name granting admin access
    admin_role: "admin"

  # JWT authentication settings
  jwt:
    # Secret string used for JWT token signing
    secret: "change-me"


# ---------------------------------------------------------
# Image derivative definitions
# ---------------------------------------------------------
derivatives:
  # Square thumbnail derivative definition
  - name: "square"

    # Filename postfix
    postfix: "-sq"

    # Maximum output width in pixels
    max_width: 300

    # Maximum output height in pixels
    max_height: 300

    # Resize mode (crop | fit)
    mode: "crop"

  # Large preview derivative definition
  - name: "large"

    # Filename postfix
    postfix: "-lg"

    # Maximum output width in pixels
    max_width: 1920

    # Maximum output height in pixels
    max_height: 1080

    # Resize mode (crop | fit)
    mode: "fit"


# ---------------------------------------------------------
# Filesystem synchronization
# ---------------------------------------------------------
sync:
  # Path-based inclusion rules
  paths:
    - # Relative filesystem path prefix
      path: "children/"

      # Filter applied to matching paths
      filters:
        op: "any"
        rules:
          - type: "rating"
            op: ">"
            value: 1

    - # Relative filesystem path prefix
      path: "travel/"

      # Filter applied to matching paths
      filters:
        op: "any"
        rules:
          - type: "year"
            op: ">="
            value: 2020

  # Allowed file extensions
  extensions:
    - "jpg"
    - "jpeg"
    - "png"
    - "tif"
    - "tiff"
    - "heic"

  # Metadata field declarations
  metadata:
    fields:
      # Capture timestamp
      taken_at:
        # Metadata value type
        type: datetime

        # Metadata source references
        sources:
          - ref: "exif:DateTimeOriginal"
          - ref: "xmp:CreateDate"

      # Camera model
      camera:
        type: string
        sources:
          - ref: "exif:Model"

      # ISO sensitivity value
      iso:
        type: int
        sources:
          - ref: "exif:ISO"

      # GPS latitude coordinate
      latitude:
        type: float
        sources:
          - ref: "exif:GPSLatitude"

      # GPS longitude coordinate
      longitude:
        type: float
        sources:
          - ref: "exif:GPSLongitude"

  # Exiftool integration
  exiftool:
    # Path to the exiftool binary
    path: "/usr/bin/exiftool"

    # Maximum execution timeout
    timeout: 5s

  # Rules defining whether an image is classified as panorama
  panorama:


# ---------------------------------------------------------
# Site metadata and public information
# ---------------------------------------------------------
site:
  # Website title
  title: "Lumenta"

  # Website author name
  author: ""

  # Base URL of the website
  baseUrl: "https://example.com"

  # Website description
  description: ""

  # Website headline text
  headline: ""

  # Path or URL to logo image
  logo-image: ""

  # Footer information
  footer:
    # Footer note text
    note: ""

    # Copyright year or range
    copyright_date: ""


# ---------------------------------------------------------
# Presentation and visual appearance
# ---------------------------------------------------------
presentation:
  # Root directory for user-provided template overrides and theme handling
  templates: "/etc/lumenta/templates"

  # Image grid rules by viewport width, role and aspect ratio
  # - First level key   : grid width in columns (e.g. 12-column grid)
  # - Second level key  : image role within the layout (normal | large | hero)
  # - Third level key   : image aspect classification (normal | landscape | tall | panorama)
  # - w, h              : number of grid cells occupied horizontally and vertically
  grid:
    # Grid configuration for a 12-column layout
    12:
      # Hero images (high-importance, visually dominant)
      hero:
        landscape: { w: 6, h: 4 }
        panorama:  { w: 6, h: 4 }
        tall:      { w: 4, h: 6 }
        # Normal images (default grid items)
      normal:    { w: 4, h: 4 }

      # Large images (emphasized but not hero)
      large:
        landscape: { w: 5, h: 3 }
        panorama:  { w: 6, h: 3 }
        tall:      { w: 3, h: 5 }
        normal:    { w: 3, h: 3 }

      normal:
        landscape: { w: 4, h: 2 }
        panorama:  { w: 6, h: 2 }
        tall:      { w: 2, h: 4 }
        normal:    { w: 2, h: 2 }
